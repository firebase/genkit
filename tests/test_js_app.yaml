# This file describes the responses to HTTP requests made
# to the reflection API.

# TODO: add more about the flow in the /api/actions test.
# TODO: add more test cases.

app: test_app
tests:
  - path: /api/runAction
    post:
      key: /model/customReflector
      input:
        messages: [{ role: user, content: [{ text: hello }] }]
    body:
      result:
        candidates:
          - index: 0.0
            finishReason: stop
            message:
              role: model
              content:
                - text: '{"messages":[{"content":[{"text":"hello"}],"role":"user"}]}'

  - path: /api/actions
    body:
      /model/customReflector:
        key: /model/customReflector
        name: customReflector
        inputSchema:
          {
            'type': 'object',
            'properties':
              {
                'messages':
                  {
                    'type': 'array',
                    'items':
                      {
                        'type': 'object',
                        'properties':
                          {
                            'role':
                              {
                                'type': 'string',
                                'enum': ['system', 'user', 'model', 'tool'],
                              },
                            'content':
                              {
                                'type': 'array',
                                'items':
                                  {
                                    'anyOf':
                                      [
                                        {
                                          'type': 'object',
                                          'properties':
                                            {
                                              'text': { 'type': 'string' },
                                              'media': { 'not': {} },
                                              'toolRequest': { 'not': {} },
                                              'toolResponse': { 'not': {} },
                                              'data': {},
                                              'metadata':
                                                {
                                                  'type': 'object',
                                                  'additionalProperties': {},
                                                },
                                            },
                                          'required': ['text'],
                                          'additionalProperties': true,
                                        },
                                        {
                                          'type': 'object',
                                          'properties':
                                            {
                                              'text': { 'not': {} },
                                              'media':
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'contentType':
                                                        { 'type': 'string' },
                                                      'url':
                                                        { 'type': 'string' },
                                                    },
                                                  'required': ['url'],
                                                  'additionalProperties': true,
                                                },
                                              'toolRequest': { 'not': {} },
                                              'toolResponse': { 'not': {} },
                                              'data': {},
                                              'metadata':
                                                {
                                                  'type': 'object',
                                                  'additionalProperties': {},
                                                },
                                            },
                                          'required': ['media'],
                                          'additionalProperties': true,
                                        },
                                        {
                                          'type': 'object',
                                          'properties':
                                            {
                                              'text': { 'not': {} },
                                              'media': { 'not': {} },
                                              'toolRequest':
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'ref':
                                                        { 'type': 'string' },
                                                      'name':
                                                        { 'type': 'string' },
                                                      'input': {},
                                                    },
                                                  'required': ['name'],
                                                  'additionalProperties': true,
                                                },
                                              'toolResponse': { 'not': {} },
                                              'data': {},
                                              'metadata':
                                                {
                                                  'type': 'object',
                                                  'additionalProperties': {},
                                                },
                                            },
                                          'required': ['toolRequest'],
                                          'additionalProperties': true,
                                        },
                                        {
                                          'type': 'object',
                                          'properties':
                                            {
                                              'text': { 'not': {} },
                                              'media': { 'not': {} },
                                              'toolRequest': { 'not': {} },
                                              'toolResponse':
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'ref':
                                                        { 'type': 'string' },
                                                      'name':
                                                        { 'type': 'string' },
                                                      'output': {},
                                                    },
                                                  'required': ['name'],
                                                  'additionalProperties': true,
                                                },
                                              'data': {},
                                              'metadata':
                                                {
                                                  'type': 'object',
                                                  'additionalProperties': {},
                                                },
                                            },
                                          'required': ['toolResponse'],
                                          'additionalProperties': true,
                                        },
                                        {
                                          'type': 'object',
                                          'properties':
                                            {
                                              'text': { 'not': {} },
                                              'media': { 'not': {} },
                                              'toolRequest': { 'not': {} },
                                              'toolResponse': { 'not': {} },
                                              'data': {},
                                              'metadata':
                                                {
                                                  'type': 'object',
                                                  'additionalProperties': {},
                                                },
                                            },
                                          'additionalProperties': true,
                                        },
                                      ],
                                  },
                              },
                            'metadata':
                              { 'type': 'object', 'additionalProperties': {} },
                          },
                        'required': ['role', 'content'],
                        'additionalProperties': true,
                      },
                  },
                'config': {},
                'tools':
                  {
                    'type': 'array',
                    'items':
                      {
                        'type': 'object',
                        'properties':
                          {
                            'name': { 'type': 'string' },
                            'description': { 'type': 'string' },
                            'inputSchema':
                              {
                                'type': 'object',
                                'additionalProperties': {},
                                'description': 'Valid JSON Schema representing the input of the tool.',
                              },
                            'outputSchema':
                              {
                                'type': 'object',
                                'additionalProperties': {},
                                'description': 'Valid JSON Schema describing the output of the tool.',
                              },
                          },
                        'required': ['name', 'description', 'inputSchema'],
                        'additionalProperties': true,
                      },
                  },
                'output':
                  {
                    'type': 'object',
                    'properties':
                      {
                        'format':
                          {
                            'type': 'string',
                            'enum': ['json', 'text', 'media'],
                          },
                        'schema':
                          { 'type': 'object', 'additionalProperties': {} },
                      },
                    'additionalProperties': true,
                  },
                'context':
                  {
                    'type': 'array',
                    'items':
                      {
                        'type': 'object',
                        'properties':
                          {
                            'content':
                              {
                                'type': 'array',
                                'items':
                                  {
                                    'anyOf':
                                      [
                                        {
                                          'type': 'object',
                                          'properties':
                                            {
                                              'text': { 'type': 'string' },
                                              'media': { 'not': {} },
                                            },
                                          'required': ['text'],
                                          'additionalProperties': true,
                                        },
                                        {
                                          'type': 'object',
                                          'properties':
                                            {
                                              'text': { 'not': {} },
                                              'media':
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'contentType':
                                                        { 'type': 'string' },
                                                      'url':
                                                        { 'type': 'string' },
                                                    },
                                                  'required': ['url'],
                                                  'additionalProperties': true,
                                                },
                                            },
                                          'required': ['media'],
                                          'additionalProperties': true,
                                        },
                                      ],
                                  },
                              },
                            'metadata':
                              { 'type': 'object', 'additionalProperties': {} },
                          },
                        'required': ['content'],
                        'additionalProperties': true,
                      },
                  },
                'candidates': { 'type': 'number' },
              },
            'required': ['messages'],
            'additionalProperties': true,
          }
        outputSchema:
          {
            'type': 'object',
            'properties':
              {
                'candidates':
                  {
                    'type': 'array',
                    'items':
                      {
                        'type': 'object',
                        'properties':
                          {
                            'index': { 'type': 'number' },
                            'message':
                              {
                                'type': 'object',
                                'properties':
                                  {
                                    'role':
                                      {
                                        'type': 'string',
                                        'enum':
                                          ['system', 'user', 'model', 'tool'],
                                      },
                                    'content':
                                      {
                                        'type': 'array',
                                        'items':
                                          {
                                            'anyOf':
                                              [
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text':
                                                        { 'type': 'string' },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['text'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media':
                                                        {
                                                          'type': 'object',
                                                          'properties':
                                                            {
                                                              'contentType':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'url':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                            },
                                                          'required': ['url'],
                                                          'additionalProperties': true,
                                                        },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['media'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        {
                                                          'type': 'object',
                                                          'properties':
                                                            {
                                                              'ref':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'name':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'input': {},
                                                            },
                                                          'required': ['name'],
                                                          'additionalProperties': true,
                                                        },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['toolRequest'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        {
                                                          'type': 'object',
                                                          'properties':
                                                            {
                                                              'ref':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'name':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'output': {},
                                                            },
                                                          'required': ['name'],
                                                          'additionalProperties': true,
                                                        },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['toolResponse'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'additionalProperties': true,
                                                },
                                              ],
                                          },
                                      },
                                    'metadata':
                                      {
                                        'type': 'object',
                                        'additionalProperties': {},
                                      },
                                  },
                                'required': ['role', 'content'],
                                'additionalProperties': true,
                              },
                            'usage':
                              {
                                'type': 'object',
                                'properties':
                                  {
                                    'inputTokens': { 'type': 'number' },
                                    'outputTokens': { 'type': 'number' },
                                    'totalTokens': { 'type': 'number' },
                                    'inputCharacters': { 'type': 'number' },
                                    'outputCharacters': { 'type': 'number' },
                                    'inputImages': { 'type': 'number' },
                                    'outputImages': { 'type': 'number' },
                                    'inputVideos': { 'type': 'number' },
                                    'outputVideos': { 'type': 'number' },
                                    'inputAudioFiles': { 'type': 'number' },
                                    'outputAudioFiles': { 'type': 'number' },
                                    'custom':
                                      {
                                        'type': 'object',
                                        'additionalProperties':
                                          { 'type': 'number' },
                                      },
                                  },
                                'additionalProperties': true,
                              },
                            'finishReason':
                              {
                                'type': 'string',
                                'enum':
                                  [
                                    'stop',
                                    'length',
                                    'blocked',
                                    'other',
                                    'unknown',
                                  ],
                              },
                            'finishMessage': { 'type': 'string' },
                            'custom': {},
                          },
                        'required': ['index', 'message', 'finishReason'],
                        'additionalProperties': true,
                      },
                  },
                'latencyMs': { 'type': 'number' },
                'usage':
                  {
                    'type': 'object',
                    'properties':
                      {
                        'inputTokens': { 'type': 'number' },
                        'outputTokens': { 'type': 'number' },
                        'totalTokens': { 'type': 'number' },
                        'inputCharacters': { 'type': 'number' },
                        'outputCharacters': { 'type': 'number' },
                        'inputImages': { 'type': 'number' },
                        'outputImages': { 'type': 'number' },
                        'inputVideos': { 'type': 'number' },
                        'outputVideos': { 'type': 'number' },
                        'inputAudioFiles': { 'type': 'number' },
                        'outputAudioFiles': { 'type': 'number' },
                        'custom':
                          {
                            'type': 'object',
                            'additionalProperties': { 'type': 'number' },
                          },
                      },
                    'additionalProperties': true,
                  },
                'custom': {},
                'request':
                  {
                    'type': 'object',
                    'properties':
                      {
                        'messages':
                          {
                            'type': 'array',
                            'items':
                              {
                                'type': 'object',
                                'properties':
                                  {
                                    'role':
                                      {
                                        'type': 'string',
                                        'enum':
                                          ['system', 'user', 'model', 'tool'],
                                      },
                                    'content':
                                      {
                                        'type': 'array',
                                        'items':
                                          {
                                            'anyOf':
                                              [
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text':
                                                        { 'type': 'string' },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['text'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media':
                                                        {
                                                          'type': 'object',
                                                          'properties':
                                                            {
                                                              'contentType':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'url':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                            },
                                                          'required': ['url'],
                                                          'additionalProperties': true,
                                                        },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['media'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        {
                                                          'type': 'object',
                                                          'properties':
                                                            {
                                                              'ref':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'name':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'input': {},
                                                            },
                                                          'required': ['name'],
                                                          'additionalProperties': true,
                                                        },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['toolRequest'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        {
                                                          'type': 'object',
                                                          'properties':
                                                            {
                                                              'ref':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'name':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'output': {},
                                                            },
                                                          'required': ['name'],
                                                          'additionalProperties': true,
                                                        },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'required': ['toolResponse'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media': { 'not': {} },
                                                      'toolRequest':
                                                        { 'not': {} },
                                                      'toolResponse':
                                                        { 'not': {} },
                                                      'data': {},
                                                      'metadata':
                                                        {
                                                          'type': 'object',
                                                          'additionalProperties':
                                                            {},
                                                        },
                                                    },
                                                  'additionalProperties': true,
                                                },
                                              ],
                                          },
                                      },
                                    'metadata':
                                      {
                                        'type': 'object',
                                        'additionalProperties': {},
                                      },
                                  },
                                'required': ['role', 'content'],
                                'additionalProperties': true,
                              },
                          },
                        'config': {},
                        'tools':
                          {
                            'type': 'array',
                            'items':
                              {
                                'type': 'object',
                                'properties':
                                  {
                                    'name': { 'type': 'string' },
                                    'description': { 'type': 'string' },
                                    'inputSchema':
                                      {
                                        'type': 'object',
                                        'additionalProperties': {},
                                        'description': 'Valid JSON Schema representing the input of the tool.',
                                      },
                                    'outputSchema':
                                      {
                                        'type': 'object',
                                        'additionalProperties': {},
                                        'description': 'Valid JSON Schema describing the output of the tool.',
                                      },
                                  },
                                'required':
                                  ['name', 'description', 'inputSchema'],
                                'additionalProperties': true,
                              },
                          },
                        'output':
                          {
                            'type': 'object',
                            'properties':
                              {
                                'format':
                                  {
                                    'type': 'string',
                                    'enum': ['json', 'text', 'media'],
                                  },
                                'schema':
                                  {
                                    'type': 'object',
                                    'additionalProperties': {},
                                  },
                              },
                            'additionalProperties': true,
                          },
                        'context':
                          {
                            'type': 'array',
                            'items':
                              {
                                'type': 'object',
                                'properties':
                                  {
                                    'content':
                                      {
                                        'type': 'array',
                                        'items':
                                          {
                                            'anyOf':
                                              [
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text':
                                                        { 'type': 'string' },
                                                      'media': { 'not': {} },
                                                    },
                                                  'required': ['text'],
                                                  'additionalProperties': true,
                                                },
                                                {
                                                  'type': 'object',
                                                  'properties':
                                                    {
                                                      'text': { 'not': {} },
                                                      'media':
                                                        {
                                                          'type': 'object',
                                                          'properties':
                                                            {
                                                              'contentType':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                              'url':
                                                                {
                                                                  'type': 'string',
                                                                },
                                                            },
                                                          'required': ['url'],
                                                          'additionalProperties': true,
                                                        },
                                                    },
                                                  'required': ['media'],
                                                  'additionalProperties': true,
                                                },
                                              ],
                                          },
                                      },
                                    'metadata':
                                      {
                                        'type': 'object',
                                        'additionalProperties': {},
                                      },
                                  },
                                'required': ['content'],
                                'additionalProperties': true,
                              },
                          },
                        'candidates': { 'type': 'number' },
                      },
                    'required': ['messages'],
                    'additionalProperties': true,
                  },
              },
            'required': ['candidates'],
            'additionalProperties': true,
          }

      /flow/testFlow:
        key: /flow/testFlow
        name: testFlow
